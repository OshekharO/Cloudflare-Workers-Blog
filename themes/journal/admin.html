<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - {{siteName}}</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.2/dist/journal/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        body { font-family: 'News Cycle', Georgia, serif; background-color: #faf9f6; }
        .sidebar { background: #1a1a1a; color: #fff; min-height: calc(100vh - 56px); }
        .sidebar .nav-link { color: rgba(255,255,255,0.8); padding: 0.75rem 1rem; margin: 0.25rem 0; border-radius: 4px; }
        .sidebar .nav-link:hover, .sidebar .nav-link.active { background: #eb6864; color: #fff; }
        .card { border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .card-header { background: #fff; border-bottom: 2px solid #1a1a1a; font-weight: 700; }
        .nav-tabs .nav-link.active { border-color: #1a1a1a #1a1a1a #fff; font-weight: 600; }
        .table th { text-transform: uppercase; font-size: 0.75rem; letter-spacing: 1px; }
        .badge-draft { background: #ffc107; color: #1a1a1a; }
        .draft-row { background: #fffbeb; }
        .btn-primary { background: #eb6864; border-color: #eb6864; }
        .btn-primary:hover { background: #d4524e; border-color: #d4524e; }
    </style>
    
    {{codeBeforHead}}
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <span class="navbar-brand"><i class="bi bi-gear-fill me-2"></i>Blog Admin</span>
            <a href="/" class="nav-link text-white"><i class="bi bi-eye me-1"></i>View Blog</a>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-2 col-md-3 sidebar p-0">
                <div class="p-3">
                    <h6 class="text-uppercase mb-3">Admin Panel</h6>
                    <ul class="nav nav-pills flex-column">
                        <li class="nav-item"><a class="nav-link active" href="#articles" data-bs-toggle="tab"><i class="bi bi-list-ul me-2"></i>Articles</a></li>
                        <li class="nav-item"><a class="nav-link" href="/admin/users"><i class="bi bi-people-fill me-2"></i>Users</a></li>
                        <li class="nav-item"><a class="nav-link" href="#tools" data-bs-toggle="tab"><i class="bi bi-tools me-2"></i>Tools</a></li>
                        <li class="nav-item"><a class="nav-link" href="/admin/edit"><i class="bi bi-plus-circle me-2"></i>New Article</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="col-lg-10 col-md-9 mt-3">
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="articles">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center py-3">
                                <h5 class="mb-0"><i class="bi bi-file-text me-2"></i>Articles</h5>
                                <a href="/admin/edit" class="btn btn-primary btn-sm"><i class="bi bi-plus-circle me-1"></i>New Article</a>
                            </div>
                            <div class="card-body">
                                <ul class="nav nav-tabs mb-4">
                                    <li class="nav-item"><button class="nav-link active" id="published-tab" data-bs-toggle="tab" data-bs-target="#published">Published</button></li>
                                    <li class="nav-item"><button class="nav-link" id="drafts-tab" data-bs-toggle="tab" data-bs-target="#drafts">Drafts</button></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane fade show active" id="published"><div id="published-list"><div class="text-center py-5"><div class="spinner-border"></div></div></div></div>
                                    <div class="tab-pane fade" id="drafts"><div id="drafts-list"><div class="text-center py-5"><div class="spinner-border"></div></div></div></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="tools">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-header"><i class="bi bi-download me-2"></i>Data Management</div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-6 text-center">
                                                <i class="bi bi-download display-6 text-success mb-2"></i>
                                                <h6>Export</h6>
                                                <button onclick="exportArticles()" class="btn btn-success btn-sm w-100">Export</button>
                                            </div>
                                            <div class="col-6 text-center">
                                                <i class="bi bi-upload display-6 text-primary mb-2"></i>
                                                <h6>Import</h6>
                                                <button onclick="openImportModal()" class="btn btn-primary btn-sm w-100">Import</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-header"><i class="bi bi-graph-up me-2"></i>SEO & Feeds</div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-6"><a href="/rss.xml" target="_blank" class="btn btn-outline-info w-100"><i class="bi bi-rss me-1"></i>RSS</a></div>
                                            <div class="col-6"><a href="/sitemap.xml" target="_blank" class="btn btn-outline-success w-100"><i class="bi bi-diagram-3 me-1"></i>Sitemap</a></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="importModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Import Articles</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <input type="file" id="importFile" accept=".json" class="form-control">
                    <div class="form-text">Choose a JSON file previously exported</div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="importArticles()">Import</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function loadArticles() {
            const response = await fetch('/api/articles');
            const articles = await response.json();
            const container = document.getElementById('published-list');
            if (articles.length === 0) {
                container.innerHTML = '<div class="text-center py-5"><i class="bi bi-inbox display-1 text-muted"></i><h5 class="text-muted mt-3">No published articles</h5><a href="/admin/edit" class="btn btn-primary mt-2">Create Article</a></div>';
                return;
            }
            container.innerHTML = `<div class="table-responsive"><table class="table table-hover"><thead><tr><th>Title</th><th>Label</th><th>Date</th><th>Actions</th></tr></thead><tbody>${articles.map(a => `<tr><td><strong>${a.title}</strong><br><small class="text-muted">/${a.permalink}</small></td><td><span class="badge bg-primary">${a.label}</span></td><td>${new Date(a.createDate).toLocaleDateString()}</td><td><div class="btn-group btn-group-sm"><a href="/admin/edit?permalink=${a.permalink}" class="btn btn-outline-primary"><i class="bi bi-pencil"></i></a><button onclick="deleteArticle('${a.permalink}')" class="btn btn-outline-danger"><i class="bi bi-trash"></i></button></div></td></tr>`).join('')}</tbody></table></div>`;
        }

        async function loadDrafts() {
            const response = await fetch('/api/articles?drafts=true');
            const drafts = await response.json();
            const container = document.getElementById('drafts-list');
            if (drafts.length === 0) {
                container.innerHTML = '<div class="text-center py-5"><i class="bi bi-file-earmark display-1 text-muted"></i><h5 class="text-muted mt-3">No drafts</h5></div>';
                return;
            }
            container.innerHTML = `<div class="table-responsive"><table class="table table-hover"><thead><tr><th>Title</th><th>Label</th><th>Date</th><th>Actions</th></tr></thead><tbody>${drafts.map(d => `<tr class="draft-row"><td><span class="badge badge-draft me-2">Draft</span><strong>${d.title}</strong><br><small class="text-muted">/${d.permalink}</small></td><td><span class="badge bg-primary">${d.label}</span></td><td>${new Date(d.createDate).toLocaleDateString()}</td><td><div class="btn-group btn-group-sm"><a href="/admin/edit?permalink=${d.permalink}" class="btn btn-outline-primary"><i class="bi bi-pencil"></i></a><button onclick="publishDraft('${d.permalink}')" class="btn btn-outline-success"><i class="bi bi-send"></i></button><button onclick="deleteArticle('${d.permalink}')" class="btn btn-outline-danger"><i class="bi bi-trash"></i></button></div></td></tr>`).join('')}</tbody></table></div>`;
        }

        async function deleteArticle(permalink) {
            if (!confirm('Delete this article?')) return;
            await fetch('/api/articles/' + permalink, { method: 'DELETE' });
            showAlert('Article deleted', 'success');
            loadArticles(); loadDrafts();
        }

        async function publishDraft(permalink) {
            const response = await fetch('/api/articles/' + permalink);
            const draft = await response.json();
            draft.status = 'published';
            await fetch('/api/articles/' + permalink, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(draft) });
            showAlert('Draft published', 'success');
            loadDrafts(); loadArticles();
        }

        async function exportArticles() {
            const response = await fetch('/api/export');
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = `blog-export-${new Date().toISOString().split('T')[0]}.json`;
            a.click(); window.URL.revokeObjectURL(url);
            showAlert('Exported successfully', 'success');
        }

        function openImportModal() { new bootstrap.Modal(document.getElementById('importModal')).show(); }

        async function importArticles() {
            const file = document.getElementById('importFile').files[0];
            if (!file) { showAlert('Please select a file', 'warning'); return; }
            const text = await file.text();
            const response = await fetch('/api/import', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: text });
            const result = await response.json();
            showAlert(`Imported ${result.imported} articles`, 'success');
            bootstrap.Modal.getInstance(document.getElementById('importModal')).hide();
            loadArticles();
        }

        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3`;
            alert.style.zIndex = '1060';
            alert.innerHTML = `${message}<button type="button" class="btn-close" data-bs-dismiss="alert"></button>`;
            document.body.appendChild(alert);
            setTimeout(() => alert.remove(), 5000);
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('published-tab').addEventListener('shown.bs.tab', loadArticles);
            document.getElementById('drafts-tab').addEventListener('shown.bs.tab', loadDrafts);
            loadArticles();
        });
    </script>
    
    {{codeBeforBody}}
</body>
</html>
