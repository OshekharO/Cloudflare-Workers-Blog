<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Users - {{siteName}}</title>
    
    <!-- Materialize CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        /* Reset and base styles */
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #fafafa;
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }
        
        /* Layout Spacing */
        .container {
            padding: 20px 15px;
        }
        
        .section {
            padding: 40px 0;
        }
        
        .card {
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .card .card-content {
            padding: 24px;
        }
        
        .card .card-title {
            font-size: 1.5rem;
            font-weight: 500;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* Header and Navigation */
        nav {
            padding: 0 20px;
        }
        
        .brand-logo {
            font-size: 1.4rem;
            font-weight: 500;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            height: 100%;
            transition: transform 0.2s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
        }
        
        .stat-card .card-content {
            padding: 30px 24px;
        }
        
        .stat-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 300;
            margin: 10px 0;
            line-height: 1;
        }
        
        .stat-label {
            font-size: 1rem;
            color: #666;
            margin: 0;
        }
        
        /* Table Styles */
        .table-container {
            margin: 30px 0;
        }
        
        table {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        table th {
            background-color: #2196f3;
            color: white;
            font-weight: 500;
            padding: 16px 12px;
            font-size: 0.9rem;
        }
        
        table td {
            padding: 16px 12px;
            vertical-align: middle;
            border-bottom: 1px solid #e0e0e0;
        }
        
        table tr:last-child td {
            border-bottom: none;
        }
        
        /* User Avatar */
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.2rem;
            color: white;
            margin-right: 15px;
        }
        
        .avatar-superadmin {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }
        
        .avatar-admin {
            background: linear-gradient(135deg, #2196f3, #1976d2);
        }
        
        /* Badges */
        .badge {
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.8rem;
            font-weight: 500;
            color: white;
        }
        
        .badge-superadmin {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }
        
        .badge-admin {
            background: linear-gradient(135deg, #2196f3, #1976d2);
        }
        
        .badge-active {
            background-color: #4caf50;
        }
        
        .badge-inactive {
            background-color: #9e9e9e;
        }
        
        /* Buttons */
        .btn {
            border-radius: 4px;
            font-weight: 500;
            text-transform: none;
            padding: 0 20px;
        }
        
        .btn-small {
            height: 36px;
            line-height: 36px;
            padding: 0 16px;
            margin: 2px;
        }
        
        .btn-flat {
            font-weight: 500;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        /* Search Bar */
        .search-container {
            display: flex;
            gap: 15px;
            align-items: center;
            margin: 25px 0;
            padding: 0 10px;
        }
        
        .search-input {
            flex: 1;
        }
        
        /* Role Guide */
        .role-guide {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 30px;
            margin: 30px 0;
        }
        
        .role-item {
            display: flex;
            align-items: center;
            padding: 20px;
            background: white;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .role-item:last-child {
            margin-bottom: 0;
        }
        
        .role-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-size: 1.5rem;
            color: white;
        }
        
        .role-content {
            flex: 1;
        }
        
        .role-content h6 {
            font-size: 1.1rem;
            font-weight: 500;
            margin: 0 0 8px 0;
        }
        
        .role-content p {
            color: #666;
            margin: 0;
            font-size: 0.9rem;
        }
        
        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 4rem;
            color: #e0e0e0;
            margin-bottom: 20px;
        }
        
        .empty-state h5 {
            font-size: 1.3rem;
            margin: 0 0 10px 0;
            color: #424242;
        }
        
        .empty-state p {
            font-size: 1rem;
            margin: 0 0 25px 0;
        }
        
        /* Loading States */
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 60px 20px;
        }
        
        /* Modal Styles */
        .modal {
            border-radius: 8px;
            max-width: 500px;
        }
        
        .modal .modal-content {
            padding: 30px;
        }
        
        .modal .modal-footer {
            padding: 20px 30px;
        }
        
        .modal h4 {
            font-size: 1.5rem;
            font-weight: 500;
            margin: 0 0 25px 0;
        }
        
        /* Form Styles */
        .input-field {
            margin-bottom: 25px;
        }
        
        .input-field label {
            font-size: 0.9rem;
            color: #666;
        }
        
        /* Responsive Design */
        @media only screen and (max-width: 992px) {
            .container {
                padding: 15px 10px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 15px;
            }
            
            .card .card-content {
                padding: 20px;
            }
            
            table th,
            table td {
                padding: 12px 8px;
            }
        }
        
        @media only screen and (max-width: 768px) {
            .section {
                padding: 30px 0;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .search-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .search-input {
                width: 100%;
            }
            
            .role-item {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .role-icon {
                margin-right: 0;
            }
            
            .action-buttons {
                justify-content: center;
            }
        }
        
        @media only screen and (max-width: 600px) {
            .container {
                padding: 10px 5px;
            }
            
            .card .card-content {
                padding: 15px;
            }
            
            .card .card-title {
                font-size: 1.3rem;
            }
            
            table {
                font-size: 0.9rem;
            }
            
            .user-avatar {
                width: 40px;
                height: 40px;
                font-size: 1rem;
                margin-right: 10px;
            }
            
            .btn-small {
                height: 32px;
                line-height: 32px;
                padding: 0 12px;
                font-size: 0.8rem;
            }
        }
        
        /* Utility Classes */
        .text-center {
            text-align: center;
        }
        
        .mb-0 {
            margin-bottom: 0 !important;
        }
        
        .mt-0 {
            margin-top: 0 !important;
        }
        
        .mb-1 {
            margin-bottom: 10px !important;
        }
        
        .mt-1 {
            margin-top: 10px !important;
        }
        
        .mb-2 {
            margin-bottom: 20px !important;
        }
        
        .mt-2 {
            margin-top: 20px !important;
        }
        
        .mb-3 {
            margin-bottom: 30px !important;
        }
        
        .mt-3 {
            margin-top: 30px !important;
        }
    </style>
    
    {{codeBeforHead}}
</head>
<body>
    <!-- Navigation -->
    <header>
        <nav class="blue darken-2">
            <div class="nav-wrapper">
                <div class="container">
                    <a href="/admin/users" class="brand-logo">
                        <i class="material-icons left">people</i>
                        <span class="hide-on-small-only">Admin Users</span>
                    </a>
                    <ul class="right">
                        <li>
                            <a href="/admin/" class="waves-effect waves-light">
                                <i class="material-icons left">arrow_back</i>
                                <span class="hide-on-small-only">Back to Admin</span>
                            </a>
                        </li>
                        <li>
                            <a href="/" class="waves-effect waves-light">
                                <i class="material-icons left">home</i>
                                <span class="hide-on-small-only">View Blog</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <!-- Page Title -->
            <div class="section">
                <h4 class="blue-text text-darken-2">
                    <i class="material-icons left">manage_accounts</i>
                    Admin Users Management
                </h4>
                <p class="grey-text">Manage admin users and their permissions</p>
            </div>

            <!-- Quick Stats -->
            <div class="stats-grid">
                <!-- Add User Card -->
                <div class="card blue lighten-5 stat-card">
                    <div class="card-content text-center">
                        <i class="material-icons blue-text stat-icon">person_add</i>
                        <h5 class="blue-text">Add Admin</h5>
                        <p class="grey-text">Create new admin user</p>
                        <button onclick="openAddAdminModal()" class="btn blue waves-effect waves-light mt-2">
                            <i class="material-icons left">add</i>Add User
                        </button>
                    </div>
                </div>
                
                <!-- Total Admins -->
                <div class="card green lighten-5 stat-card">
                    <div class="card-content text-center">
                        <i class="material-icons green-text stat-icon">people</i>
                        <div class="stat-number green-text" id="total-admins">0</div>
                        <p class="stat-label">Total Admins</p>
                    </div>
                </div>
                
                <!-- Super Admins -->
                <div class="card orange lighten-5 stat-card">
                    <div class="card-content text-center">
                        <i class="material-icons orange-text stat-icon">shield</i>
                        <div class="stat-number orange-text" id="superadmin-count">0</div>
                        <p class="stat-label">Super Admins</p>
                    </div>
                </div>
                
                <!-- Active Users -->
                <div class="card teal lighten-5 stat-card">
                    <div class="card-content text-center">
                        <i class="material-icons teal-text stat-icon">person_check</i>
                        <div class="stat-number teal-text" id="active-admins">0</div>
                        <p class="stat-label">Active Users</p>
                    </div>
                </div>
            </div>

            <!-- Users Management Card -->
            <div class="card">
                <div class="card-content">
                    <div class="card-title">
                        <i class="material-icons blue-text">list</i>
                        Admin Users List
                    </div>
                    
                    <!-- Search and Actions -->
                    <div class="search-container">
                        <div class="search-input">
                            <div class="input-field">
                                <i class="material-icons prefix">search</i>
                                <input type="text" id="search-admins" placeholder="Search by username, email, or role...">
                            </div>
                        </div>
                        <button onclick="loadAdmins()" class="btn blue waves-effect waves-light">
                            <i class="material-icons">refresh</i>
                            <span class="hide-on-small-only">Refresh</span>
                        </button>
                    </div>
                    
                    <!-- Users List -->
                    <div id="admins-list">
                        <div class="loading-container">
                            <div class="preloader-wrapper big active">
                                <div class="spinner-layer spinner-blue-only">
                                    <div class="circle-clipper left">
                                        <div class="circle"></div>
                                    </div>
                                    <div class="gap-patch">
                                        <div class="circle"></div>
                                    </div>
                                    <div class="circle-clipper right">
                                        <div class="circle"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Role Guide -->
            <div class="card">
                <div class="card-content">
                    <div class="card-title">
                        <i class="material-icons blue-text">info</i>
                        Admin Roles Guide
                    </div>
                    <div class="role-guide">
                        <div class="role-item">
                            <div class="role-icon avatar-superadmin">
                                <i class="material-icons">security</i>
                            </div>
                            <div class="role-content">
                                <h6>Super Admin</h6>
                                <p>Full system access with complete control over the blog system. Can manage other admins, system settings, and all content.</p>
                            </div>
                            <span class="badge badge-superadmin">Super Admin</span>
                        </div>
                        
                        <div class="role-item">
                            <div class="role-icon avatar-admin">
                                <i class="material-icons">person</i>
                            </div>
                            <div class="role-content">
                                <h6>Admin</h6>
                                <p>Content management access only. Can create, edit, and delete articles but cannot manage users or system settings.</p>
                            </div>
                            <span class="badge badge-admin">Admin</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="page-footer blue darken-2">
        <div class="container">
            <div class="row">
                <div class="col s12 center-align">
                    <p class="white-text mb-0">{{copyRight}}</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Add Admin Modal -->
    <div id="add-admin-modal" class="modal">
        <div class="modal-content">
            <h4>Add New Admin</h4>
            <form id="add-admin-form">
                <div class="row">
                    <div class="input-field col s12">
                        <input id="username" type="text" required>
                        <label for="username">Username</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <input id="password" type="password" required>
                        <label for="password">Password</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <input id="email" type="email" required>
                        <label for="email">Email</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <select id="role" required>
                            <option value="" disabled selected>Choose role</option>
                            <option value="admin">Admin</option>
                            <option value="superadmin">Super Admin</option>
                        </select>
                        <label>Role</label>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-close waves-effect waves-red btn-flat">Cancel</a>
            <a href="#!" class="waves-effect waves-green btn blue" onclick="addAdmin()">
                <i class="material-icons left">person_add</i>Add Admin
            </a>
        </div>
    </div>

    <!-- Edit Admin Modal -->
    <div id="edit-admin-modal" class="modal">
        <div class="modal-content">
            <h4>Edit Admin</h4>
            <form id="edit-admin-form">
                <input type="hidden" id="edit-admin-id">
                <div class="row">
                    <div class="input-field col s12">
                        <input id="edit-username" type="text" readonly>
                        <label for="edit-username">Username</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <input id="edit-email" type="email" required>
                        <label for="edit-email">Email</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <select id="edit-role" required>
                            <option value="admin">Admin</option>
                            <option value="superadmin">Super Admin</option>
                        </select>
                        <label>Role</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <select id="edit-status" required>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                        <label>Status</label>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-close waves-effect waves-red btn-flat">Cancel</a>
            <a href="#!" class="waves-effect waves-green btn blue" onclick="updateAdmin()">
                <i class="material-icons left">save</i>Save Changes
            </a>
        </div>
    </div>

    <!-- Materialize JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    
    <script>
        // JavaScript code remains the same as previous version
        // (It's already well-structured and functional)
        let currentAdmins = [];

        document.addEventListener('DOMContentLoaded', function() {
            M.AutoInit();
            M.Modal.init(document.querySelectorAll('.modal'));
            M.FormSelect.init(document.querySelectorAll('select'));
            
            loadAdmins();
            
            // Search functionality
            const searchInput = document.getElementById('search-admins');
            let searchTimeout;
            searchInput.addEventListener('input', function(e) {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    filterAdmins(e.target.value);
                }, 300);
            });
        });

        async function loadAdmins() {
            try {
                const response = await fetch('/api/admins');
                if (!response.ok) {
                    if (response.status === 401) {
                        M.toast({html: 'Authentication required. Please log in again.', classes: 'red'});
                        return;
                    }
                    if (response.status === 403) {
                        M.toast({html: 'Access denied. Only superadmins can manage users.', classes: 'red'});
                        return;
                    }
                    throw new Error('Failed to load admins');
                }
                
                currentAdmins = await response.json();
                displayAdmins(currentAdmins);
                updateStats();
            } catch (error) {
                console.error('Error loading admins:', error);
                M.toast({html: 'Error loading admins: ' + error.message, classes: 'red'});
            }
        }

        function displayAdmins(admins) {
            const container = document.getElementById('admins-list');

            if (admins.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="material-icons">people_outline</i>
                        <h5>No Admin Users</h5>
                        <p>Get started by adding your first admin user</p>
                        <button onclick="openAddAdminModal()" class="btn blue waves-effect waves-light">
                            <i class="material-icons left">person_add</i>Add Admin
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="table-container">
                    <table class="striped responsive-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th class="hide-on-small-only">Role</th>
                                <th class="hide-on-med-and-down">Status</th>
                                <th class="hide-on-med-and-down">Joined</th>
                                <th class="hide-on-small-only">Last Login</th>
                                <th width="140">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${admins.map(admin => `
                                <tr>
                                    <td>
                                        <div style="display: flex; align-items: center;">
                                            <div class="user-avatar ${admin.role === 'superadmin' ? 'avatar-superadmin' : 'avatar-admin'}">
                                                ${admin.username.charAt(0).toUpperCase()}
                                            </div>
                                            <div>
                                                <strong>${admin.username}</strong>
                                                <br><small class="grey-text">${admin.email}</small>
                                                <div class="show-on-small hide-on-med-and-up">
                                                    <span class="badge ${admin.role === 'superadmin' ? 'badge-superadmin' : 'badge-admin'}">${admin.role}</span>
                                                    <span class="badge ${admin.status === 'active' ? 'badge-active' : 'badge-inactive'}">${admin.status}</span>
                                                    <br><small class="grey-text">Joined: ${new Date(admin.createdAt).toLocaleDateString()}</small>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="hide-on-small-only">
                                        <span class="badge ${admin.role === 'superadmin' ? 'badge-superadmin' : 'badge-admin'}">
                                            ${admin.role}
                                        </span>
                                    </td>
                                    <td class="hide-on-med-and-down">
                                        <span class="badge ${admin.status === 'active' ? 'badge-active' : 'badge-inactive'}">
                                            ${admin.status}
                                        </span>
                                    </td>
                                    <td class="hide-on-med-and-down">
                                        <small class="grey-text">${new Date(admin.createdAt).toLocaleDateString()}</small>
                                    </td>
                                    <td class="hide-on-small-only">
                                        <small class="grey-text">
                                            ${admin.lastLogin ? new Date(admin.lastLogin).toLocaleDateString() : 'Never'}
                                        </small>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button onclick="editAdmin('${admin.id}')" class="btn-small blue waves-effect waves-light" title="Edit">
                                                <i class="material-icons">edit</i>
                                            </button>
                                            <button onclick="deleteAdmin('${admin.id}', '${admin.username}')" 
                                                    class="btn-small red waves-effect waves-light" 
                                                    title="Delete"
                                                    ${admin.role === 'superadmin' ? 'disabled' : ''}>
                                                <i class="material-icons">delete</i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function filterAdmins(searchTerm) {
            const filteredAdmins = currentAdmins.filter(
                admin => admin.username.toLowerCase().includes(searchTerm.toLowerCase()) || 
                         admin.email.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         admin.role.toLowerCase().includes(searchTerm.toLowerCase())
            );
            displayAdmins(filteredAdmins);
        }

        function updateStats() {
            const totalAdmins = currentAdmins.length;
            const superadminCount = currentAdmins.filter(admin => admin.role === 'superadmin').length;
            const activeAdmins = currentAdmins.filter(admin => admin.status === 'active').length;

            document.getElementById('total-admins').textContent = totalAdmins;
            document.getElementById('superadmin-count').textContent = superadminCount;
            document.getElementById('active-admins').textContent = activeAdmins;
        }

        // Modal functions
        function openAddAdminModal() {
            const modal = M.Modal.getInstance(document.getElementById('add-admin-modal'));
            document.getElementById('add-admin-form').reset();
            M.updateTextFields();
            modal.open();
        }

        function openEditAdminModal() {
            const modal = M.Modal.getInstance(document.getElementById('edit-admin-modal'));
            modal.open();
        }

        // Admin management functions (same as before)
        async function addAdmin() {
            const formData = {
                username: document.getElementById('username').value,
                password: document.getElementById('password').value,
                email: document.getElementById('email').value,
                role: document.getElementById('role').value,
            };

            try {
                const response = await fetch('/api/admins', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData),
                });

                if (response.ok) {
                    M.toast({html: 'Admin created successfully', classes: 'green'});
                    M.Modal.getInstance(document.getElementById('add-admin-modal')).close();
                    loadAdmins();
                } else {
                    if (response.status === 401) {
                        M.toast({html: 'Authentication required. Please log in again.', classes: 'red'});
                        return;
                    }
                    if (response.status === 403) {
                        M.toast({html: 'Access denied. Only superadmins can manage users.', classes: 'red'});
                        return;
                    }
                    const error = await response.text();
                    throw new Error(error);
                }
            } catch (error) {
                console.error('Error creating admin:', error);
                M.toast({html: 'Error creating admin: ' + error.message, classes: 'red'});
            }
        }

        async function editAdmin(adminId) {
            const admin = currentAdmins.find(a => a.id === adminId);
            if (!admin) return;

            document.getElementById('edit-admin-id').value = admin.id;
            document.getElementById('edit-username').value = admin.username;
            document.getElementById('edit-email').value = admin.email;
            document.getElementById('edit-role').value = admin.role;
            document.getElementById('edit-status').value = admin.status;

            // Update select elements
            M.FormSelect.init(document.querySelectorAll('#edit-admin-modal select'));
            M.updateTextFields();
            
            openEditAdminModal();
        }

        async function updateAdmin() {
            const adminId = document.getElementById('edit-admin-id').value;
            const updateData = {
                email: document.getElementById('edit-email').value,
                role: document.getElementById('edit-role').value,
                status: document.getElementById('edit-status').value,
            };

            try {
                const response = await fetch('/api/admins/' + adminId, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updateData),
                });

                if (response.ok) {
                    M.toast({html: 'Admin updated successfully', classes: 'green'});
                    M.Modal.getInstance(document.getElementById('edit-admin-modal')).close();
                    loadAdmins();
                } else {
                    if (response.status === 401) {
                        M.toast({html: 'Authentication required. Please log in again.', classes: 'red'});
                        return;
                    }
                    if (response.status === 403) {
                        M.toast({html: 'Access denied. Only superadmins can manage users.', classes: 'red'});
                        return;
                    }
                    const error = await response.text();
                    throw new Error(error);
                }
            } catch (error) {
                console.error('Error updating admin:', error);
                M.toast({html: 'Error updating admin: ' + error.message, classes: 'red'});
            }
        }

        async function deleteAdmin(adminId, username) {
            if (!confirm(`Are you sure you want to delete admin "${username}"? This action cannot be undone.`)) return;

            try {
                const response = await fetch('/api/admins/' + adminId, {
                    method: 'DELETE',
                });

                if (response.ok) {
                    M.toast({html: 'Admin deleted successfully', classes: 'green'});
                    loadAdmins();
                } else {
                    if (response.status === 401) {
                        M.toast({html: 'Authentication required. Please log in again.', classes: 'red'});
                        return;
                    }
                    if (response.status === 403) {
                        M.toast({html: 'Access denied. Only superadmins can manage users.', classes: 'red'});
                        return;
                    }
                    const error = await response.text();
                    throw new Error(error);
                }
            } catch (error) {
                console.error('Error deleting admin:', error);
                M.toast({html: 'Error deleting admin: ' + error.message, classes: 'red'});
            }
        }
    </script>
    
    {{codeBeforBody}}
</body>
</html>
