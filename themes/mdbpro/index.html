<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{siteName}}</title>
    <meta name="description" content="{{siteDescription}}">
    <meta name="keywords" content="{{keyWords}}">
    
    <!-- MDB UI Kit CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.1.0/mdb.min.css" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Roboto Font -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --mdb-primary: #1976d2;
            --mdb-primary-dark: #1565c0;
            --mdb-secondary: #9c27b0;
            --mdb-accent: #00bcd4;
            --mdb-surface: #ffffff;
            --mdb-background: #fafafa;
            --mdb-error: #d32f2f;
            --mdb-success: #388e3c;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --gradient-danger: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --elevation-1: 0 2px 1px -1px rgba(0,0,0,.2), 0 1px 1px 0 rgba(0,0,0,.14), 0 1px 3px 0 rgba(0,0,0,.12);
            --elevation-2: 0 3px 1px -2px rgba(0,0,0,.2), 0 2px 2px 0 rgba(0,0,0,.14), 0 1px 5px 0 rgba(0,0,0,.12);
            --elevation-4: 0 2px 4px -1px rgba(0,0,0,.2), 0 4px 5px 0 rgba(0,0,0,.14), 0 1px 10px 0 rgba(0,0,0,.12);
            --elevation-8: 0 5px 5px -3px rgba(0,0,0,.2), 0 8px 10px 1px rgba(0,0,0,.14), 0 3px 14px 2px rgba(0,0,0,.12);
        }
        
        * {
            font-family: 'Roboto', sans-serif;
        }
        
        body {
            background: var(--mdb-background);
            min-height: 100vh;
        }
        
        /* Navbar Styles */
        .navbar-material {
            background: var(--gradient-primary) !important;
            box-shadow: var(--elevation-4);
        }
        
        .navbar-brand {
            font-weight: 500;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .navbar-brand .material-icons {
            font-size: 1.5rem;
        }
        
        /* Hero Dashboard Section */
        .hero-dashboard {
            background: var(--gradient-primary);
            padding: 100px 0 60px;
            position: relative;
            overflow: hidden;
        }
        
        .hero-dashboard::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%23ffffff' fill-opacity='0.05' d='M0,192L48,197.3C96,203,192,213,288,218.7C384,224,480,224,576,213.3C672,203,768,181,864,186.7C960,192,1056,224,1152,229.3C1248,235,1344,213,1392,202.7L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E") no-repeat bottom;
            background-size: cover;
        }
        
        .hero-content {
            position: relative;
            z-index: 1;
        }
        
        .hero-title {
            font-size: 2.5rem;
            font-weight: 500;
            color: white;
            margin-bottom: 1rem;
            letter-spacing: -0.5px;
        }
        
        .hero-subtitle {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.85);
            font-weight: 300;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* Dashboard Stats Cards */
        .stats-row {
            margin-top: -50px;
            position: relative;
            z-index: 10;
        }
        
        .stat-card {
            border-radius: 8px;
            box-shadow: var(--elevation-2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            overflow: hidden;
        }
        
        .stat-card:hover {
            box-shadow: var(--elevation-8);
            transform: translateY(-4px);
        }
        
        .stat-card .card-body {
            padding: 1.5rem;
        }
        
        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.75rem;
            margin-top: -35px;
            box-shadow: var(--elevation-4);
        }
        
        .stat-icon.gradient-1 { background: var(--gradient-primary); }
        .stat-icon.gradient-2 { background: var(--gradient-secondary); }
        .stat-icon.gradient-3 { background: var(--gradient-danger); }
        
        .stat-value {
            font-size: 1.75rem;
            font-weight: 500;
            color: #3c4858;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #999;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Content Section */
        .content-section {
            padding: 40px 0 60px;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 500;
            color: #3c4858;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .section-title .material-icons {
            color: var(--mdb-primary);
        }
        
        /* Article Cards */
        .article-card {
            border-radius: 8px;
            box-shadow: var(--elevation-1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            overflow: hidden;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .article-card:hover {
            box-shadow: var(--elevation-8);
            transform: translateY(-6px);
        }
        
        .article-card .card-img-top {
            height: 180px;
            object-fit: cover;
            transition: transform 0.4s ease;
        }
        
        .article-card:hover .card-img-top {
            transform: scale(1.05);
        }
        
        .card-img-wrapper {
            overflow: hidden;
            position: relative;
        }
        
        .card-img-overlay-gradient {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
        }
        
        .article-card .card-body {
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        
        .article-card .card-title {
            font-size: 1.1rem;
            font-weight: 500;
            color: #3c4858;
            margin-bottom: 0.75rem;
            line-height: 1.4;
        }
        
        .article-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
        }
        
        .article-meta span {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.8rem;
            color: #999;
        }
        
        .article-meta .material-icons {
            font-size: 1rem;
        }
        
        .article-excerpt {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.6;
            flex-grow: 1;
            margin-bottom: 1rem;
        }
        
        .chip {
            display: inline-flex;
            align-items: center;
            padding: 0.35rem 0.75rem;
            border-radius: 16px;
            font-size: 0.75rem;
            font-weight: 500;
            background: var(--gradient-primary);
            color: white;
        }
        
        /* Buttons */
        .btn-material {
            border-radius: 4px;
            text-transform: uppercase;
            font-weight: 500;
            letter-spacing: 0.5px;
            padding: 0.6rem 1.25rem;
            font-size: 0.875rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--elevation-2);
        }
        
        .btn-material:hover {
            box-shadow: var(--elevation-4);
            transform: translateY(-2px);
        }
        
        .btn-material-primary {
            background: var(--gradient-primary);
            color: white;
            border: none;
        }
        
        .btn-material-primary:hover {
            color: white;
        }
        
        .btn-material-outline {
            background: transparent;
            border: 2px solid var(--mdb-primary);
            color: var(--mdb-primary);
        }
        
        .btn-material-outline:hover {
            background: var(--mdb-primary);
            color: white;
        }
        
        /* FAB Button */
        .fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--gradient-danger);
            color: white;
            border: none;
            box-shadow: var(--elevation-4);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            text-decoration: none;
        }
        
        .fab:hover {
            box-shadow: var(--elevation-8);
            transform: scale(1.1);
            color: white;
        }
        
        .fab .material-icons {
            font-size: 1.5rem;
        }
        
        /* Placeholder Card */
        .placeholder-img {
            height: 180px;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .placeholder-img .material-icons {
            font-size: 3rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            background: white;
            border-radius: 8px;
            box-shadow: var(--elevation-1);
        }
        
        .empty-state .material-icons {
            font-size: 4rem;
            color: #ccc;
            margin-bottom: 1rem;
        }
        
        .empty-state h3 {
            color: #666;
            margin-bottom: 0.5rem;
        }
        
        .empty-state p {
            color: #999;
        }
        
        /* Footer */
        .footer-material {
            background: #263238;
            color: rgba(255, 255, 255, 0.7);
            padding: 2rem 0;
            margin-top: 3rem;
        }
        
        .footer-material a {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            transition: color 0.2s ease;
        }
        
        .footer-material a:hover {
            color: var(--mdb-accent);
        }
        
        /* Pagination */
        .pagination-material .page-link {
            border: none;
            margin: 0 4px;
            border-radius: 4px;
            color: #666;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .pagination-material .page-link:hover {
            background: var(--gradient-primary);
            color: white;
        }
        
        .pagination-material .page-item.active .page-link {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--elevation-2);
        }
        
        /* Share Modal */
        .modal-material .modal-content {
            border-radius: 8px;
            border: none;
            box-shadow: var(--elevation-8);
        }
        
        .modal-material .modal-header {
            border-bottom: 1px solid #eee;
            padding: 1.25rem 1.5rem;
        }
        
        .modal-material .modal-body {
            padding: 1.5rem;
        }
        
        .share-btn-group .btn {
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 0.5rem;
            transition: all 0.3s ease;
        }
        
        .share-btn-group .btn:hover {
            transform: scale(1.1);
        }
        
        /* Bookmark button */
        .bookmark-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: none;
            box-shadow: var(--elevation-2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 5;
        }
        
        .bookmark-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--elevation-4);
        }
        
        .bookmark-btn.bookmarked .material-icons {
            color: #f5576c;
        }
        
        /* Ripple effect */
        .ripple {
            position: relative;
            overflow: hidden;
        }
        
        @media (max-width: 768px) {
            .hero-title {
                font-size: 1.75rem;
            }
            
            .hero-subtitle {
                font-size: 1rem;
            }
            
            .hero-dashboard {
                padding: 80px 0 50px;
            }
            
            .stats-row {
                margin-top: -30px;
            }
            
            .stat-card .card-body {
                padding: 1rem;
            }
            
            .stat-value {
                font-size: 1.25rem;
            }
            
            .fab {
                bottom: 1.5rem;
                right: 1.5rem;
            }
        }
        
        /* Loading spinner */
        .spinner-material {
            color: var(--mdb-primary);
        }
    </style>
    
    {{codeBeforHead}}
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark navbar-material fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">
                <span class="material-icons">dashboard</span>
                {{siteName}}
            </a>
            <button class="navbar-toggler" type="button" data-mdb-toggle="collapse" data-mdb-target="#navbarNav">
                <span class="material-icons">menu</span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/bookmarks">
                            <span class="material-icons me-1">bookmark</span> Bookmarks
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/">
                            <span class="material-icons me-1">admin_panel_settings</span> Admin
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Dashboard Section -->
    <section class="hero-dashboard">
        <div class="container">
            <div class="hero-content text-center">
                <h1 class="hero-title">{{siteName}}</h1>
                <p class="hero-subtitle">{{siteDescription}}</p>
            </div>
        </div>
    </section>

    <!-- Stats Row -->
    <section class="container stats-row">
        <div class="row g-4">
            <div class="col-lg-4 col-md-6">
                <div class="card stat-card">
                    <div class="card-body text-end">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="stat-icon gradient-1">
                                <span class="material-icons">article</span>
                            </div>
                            <div>
                                <p class="stat-label mb-0">Articles</p>
                                <h3 class="stat-value mb-0" id="articles-count">0</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="card stat-card">
                    <div class="card-body text-end">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="stat-icon gradient-2">
                                <span class="material-icons">category</span>
                            </div>
                            <div>
                                <p class="stat-label mb-0">Categories</p>
                                <h3 class="stat-value mb-0" id="categories-count">0</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="card stat-card">
                    <div class="card-body text-end">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="stat-icon gradient-3">
                                <span class="material-icons">bookmark</span>
                            </div>
                            <div>
                                <p class="stat-label mb-0">Bookmarks</p>
                                <h3 class="stat-value mb-0" id="bookmarks-count">0</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Content Section -->
    <section class="content-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="material-icons">library_books</span>
                    Latest Articles
                </h2>
            </div>
            
            <div class="row g-4" id="articles-container">
                <div class="col-12 text-center py-5">
                    <div class="spinner-border spinner-material" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
            
            <!-- Pagination -->
            <div id="pagination-container" class="mt-5"></div>
        </div>
    </section>

    <!-- FAB Button -->
    <a href="/admin/edit" class="fab" title="Create New Article">
        <span class="material-icons">add</span>
    </a>

    <!-- Share Modal -->
    <div class="modal fade modal-material" id="shareModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <span class="material-icons me-2">share</span>Share Article
                    </h5>
                    <button type="button" class="btn-close" data-mdb-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="share-article-title" class="text-muted mb-4"></p>
                    <div class="share-btn-group d-flex justify-content-center">
                        <button onclick="shareOnPlatform('twitter')" class="btn btn-info">
                            <span class="material-icons">tag</span>
                        </button>
                        <button onclick="shareOnPlatform('facebook')" class="btn btn-primary">
                            <span class="material-icons">facebook</span>
                        </button>
                        <button onclick="shareOnPlatform('linkedin')" class="btn btn-secondary">
                            <span class="material-icons">work</span>
                        </button>
                        <button onclick="copyArticleLink()" class="btn btn-dark">
                            <span class="material-icons">link</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer-material">
        <div class="container text-center">
            <p class="mb-0">{{copyRight}}</p>
        </div>
    </footer>

    <!-- MDB JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.1.0/mdb.umd.min.js"></script>
    
    <script>
        let currentSharePermalink = '';
        let currentShareTitle = '';
        let currentPage = 1;
        let totalPages = 1;
        const pageSize = 9;

        // Bookmark Functions
        function getBookmarks() {
            return JSON.parse(localStorage.getItem('blog_bookmarks') || '[]');
        }

        function saveBookmarks(bookmarks) {
            localStorage.setItem('blog_bookmarks', JSON.stringify(bookmarks));
        }

        function isArticleBookmarked(permalink) {
            const bookmarks = getBookmarks();
            return bookmarks.some(b => b.permalink === permalink);
        }

        function toggleBookmark(permalink, title, img, label) {
            const bookmarks = getBookmarks();
            const existingIndex = bookmarks.findIndex(b => b.permalink === permalink);
            
            if (existingIndex > -1) {
                bookmarks.splice(existingIndex, 1);
                saveBookmarks(bookmarks);
                showSnackbar('Bookmark removed');
            } else {
                bookmarks.push({
                    permalink,
                    title,
                    img,
                    label,
                    bookmarkedAt: new Date().toISOString()
                });
                saveBookmarks(bookmarks);
                showSnackbar('Article bookmarked!');
            }
            
            updateBookmarkCount();
            loadArticles(currentPage);
        }

        function updateBookmarkCount() {
            const bookmarks = getBookmarks();
            document.getElementById('bookmarks-count').textContent = bookmarks.length;
        }

        // Share Functions
        function shareArticle(permalink, title) {
            currentSharePermalink = permalink;
            currentShareTitle = title;
            document.getElementById('share-article-title').textContent = title;
            const modal = new mdb.Modal(document.getElementById('shareModal'));
            modal.show();
        }

        function shareOnPlatform(platform) {
            const url = `${window.location.origin}/article/${currentSharePermalink}`;
            const shareUrls = {
                twitter: `https://twitter.com/intent/tweet?text=${encodeURIComponent(currentShareTitle)}&url=${encodeURIComponent(url)}`,
                facebook: `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`,
                linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`
            };
            window.open(shareUrls[platform], '_blank', 'width=600,height=400');
            mdb.Modal.getInstance(document.getElementById('shareModal')).hide();
        }

        async function copyArticleLink() {
            const url = `${window.location.origin}/article/${currentSharePermalink}`;
            try {
                await navigator.clipboard.writeText(url);
                showSnackbar('Link copied to clipboard!');
            } catch (err) {
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showSnackbar('Link copied to clipboard!');
            }
            mdb.Modal.getInstance(document.getElementById('shareModal')).hide();
        }

        function showSnackbar(message) {
            // Create snackbar element
            const snackbar = document.createElement('div');
            snackbar.className = 'position-fixed bottom-0 start-50 translate-middle-x p-3';
            snackbar.style.zIndex = '1100';
            snackbar.innerHTML = `
                <div class="toast show" role="alert">
                    <div class="toast-body d-flex align-items-center">
                        <span class="material-icons me-2 text-success">check_circle</span>
                        ${message}
                    </div>
                </div>
            `;
            document.body.appendChild(snackbar);
            
            setTimeout(() => {
                snackbar.remove();
            }, 3000);
        }

        // Article Loading
        async function loadArticles(page = 1) {
            try {
                currentPage = page;
                const response = await fetch(`/api/articles?paginate=true&page=${page}&pageSize=${pageSize}`);
                if (!response.ok) throw new Error('Failed to load articles');
                
                const data = await response.json();
                const articles = data.articles || [];
                const pagination = data.pagination || {};
                totalPages = pagination.totalPages || 1;
                
                // Update stats
                document.getElementById('articles-count').textContent = pagination.totalArticles || 0;
                
                // Load categories count
                loadCategories();
                
                const container = document.getElementById('articles-container');
                
                if (articles.length === 0) {
                    container.innerHTML = `
                        <div class="col-12">
                            <div class="empty-state">
                                <span class="material-icons">article</span>
                                <h3>No Articles Yet</h3>
                                <p>Start creating content to see it here!</p>
                                <a href="/admin/edit" class="btn btn-material btn-material-primary mt-3">
                                    <span class="material-icons me-2">add</span> Create Article
                                </a>
                            </div>
                        </div>
                    `;
                    return;
                }

                const escapeHtml = (str) => {
                    if (!str) return '';
                    return String(str)
                        .replace(/&/g, '&amp;')
                        .replace(/</g, '&lt;')
                        .replace(/>/g, '&gt;')
                        .replace(/"/g, '&quot;')
                        .replace(/'/g, '&#039;');
                };

                container.innerHTML = articles.map(article => {
                    const isBookmarked = isArticleBookmarked(article.permalink);
                    const safeTitle = escapeHtml(article.title);
                    const safeImg = escapeHtml(article.img);
                    const safePermalink = escapeHtml(article.permalink);
                    const safeLabel = escapeHtml(article.label);
                    const safeExcerpt = escapeHtml(article.excerpt);

                    const imgHtml = article.img ? 
                        `<div class="card-img-wrapper">
                            <img src="${safeImg}" class="card-img-top" alt="${safeTitle}">
                            <div class="card-img-overlay-gradient"></div>
                        </div>` : 
                        `<div class="placeholder-img">
                            <span class="material-icons">description</span>
                        </div>`;
                    
                    return `
                    <div class="col-lg-4 col-md-6">
                        <div class="card article-card ripple">
                            <button class="bookmark-btn ${isBookmarked ? 'bookmarked' : ''}" 
                                    onclick="toggleBookmark('${safePermalink}', '${safeTitle.replace(/'/g, "\\'")}', '${safeImg}', '${safeLabel}')"
                                    title="${isBookmarked ? 'Remove bookmark' : 'Bookmark article'}">
                                <span class="material-icons">${isBookmarked ? 'bookmark' : 'bookmark_border'}</span>
                            </button>
                            ${imgHtml}
                            <div class="card-body">
                                <div class="article-meta">
                                    <span><span class="material-icons">calendar_today</span> ${new Date(article.createDate).toLocaleDateString()}</span>
                                    <span class="chip">${safeLabel}</span>
                                </div>
                                <h5 class="card-title">${safeTitle}</h5>
                                <p class="article-excerpt">${safeExcerpt}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <a href="/article/${safePermalink}" class="btn btn-material btn-material-primary btn-sm">
                                        Read More
                                    </a>
                                    <button onclick="shareArticle('${safePermalink}', '${safeTitle.replace(/'/g, "\\'")}')" 
                                            class="btn btn-link text-muted p-0" title="Share">
                                        <span class="material-icons">share</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    `;
                }).join('');

                updatePaginationUI(pagination);
            } catch (error) {
                console.error('Error loading articles:', error);
                document.getElementById('articles-container').innerHTML = `
                    <div class="col-12">
                        <div class="empty-state">
                            <span class="material-icons text-danger">error</span>
                            <h3>Error Loading Articles</h3>
                            <p>Please try again later.</p>
                            <button onclick="loadArticles()" class="btn btn-material btn-material-primary mt-3">
                                <span class="material-icons me-2">refresh</span> Retry
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        async function loadCategories() {
            try {
                const response = await fetch('/api/categories');
                if (response.ok) {
                    const categories = await response.json();
                    document.getElementById('categories-count').textContent = Object.keys(categories).length;
                }
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        function updatePaginationUI(pagination) {
            const container = document.getElementById('pagination-container');
            if (!container) return;
            
            if (pagination.totalPages <= 1) {
                container.innerHTML = '';
                return;
            }

            let html = '<nav aria-label="Article pagination"><ul class="pagination pagination-material justify-content-center">';
            
            html += `<li class="page-item ${!pagination.hasPrevPage ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="loadArticles(${pagination.page - 1}); return false;">
                    <span class="material-icons">chevron_left</span>
                </a>
            </li>`;

            const startPage = Math.max(1, pagination.page - 2);
            const endPage = Math.min(pagination.totalPages, pagination.page + 2);

            for (let i = startPage; i <= endPage; i++) {
                html += `<li class="page-item ${i === pagination.page ? 'active' : ''}">
                    <a class="page-link" href="#" onclick="loadArticles(${i}); return false;">${i}</a>
                </li>`;
            }

            html += `<li class="page-item ${!pagination.hasNextPage ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="loadArticles(${pagination.page + 1}); return false;">
                    <span class="material-icons">chevron_right</span>
                </a>
            </li>`;

            html += '</ul></nav>';
            html += `<p class="text-center text-muted mt-2">Page ${pagination.page} of ${pagination.totalPages} (${pagination.totalArticles} articles)</p>`;

            container.innerHTML = html;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadArticles();
            updateBookmarkCount();
        });
    </script>
    
    {{codeBeforBody}}
</body>
</html>
